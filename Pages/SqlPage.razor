@page "/SqlPage"
@inject IJSRuntime Js;
@namespace allmylinks
@if (isLoading)
{
	<div id="spinner" style="display: flex; justify-content: center; align-items: center;">
	<!-- height: 100vh; width: 100%; -->
	<div class="spinner">
		<div class="rect1"></div>
		<div class="rect2"></div>
		<div class="rect3"></div>
		<div class="rect4"></div>
		<div class="rect5"></div>
	</div>
</div>
}
@if (!isLoading)
{
	<div class='container-fluid'>
	<div class='row'>
		<div class='col-sm-4 pr-0'>
			<div id='infoPanel' class="card rounded-0 border-left-0">
				<table class='table table-condensed small'>
					<thead>
						<tr>
							<td colspan='2'>
								<span class='float-right'>▷▷▷ <button id='upload-btn' type='button' class='btn btn-sm btn-light text-secondary border-secondary rounded-0'><small>📂 Select SQLite File…</small><input id='upload' type='file' /></button></span>
								<hr class='invisible-divider'>
								<p class="h6">💡 <small>Original work by Kripken <cite title="sql.js/sql.js: A javascript library to run SQLite on the web."><a href="https://github.com/sql-js/sql.js" target="_blank">sql.js</a></cite> which is <a href="LICENSE.txt" target="_blank">MIT licensed</a>.</small></p>
								<p class="h6">ℹ <small>SQLite is a <abbr title="Relational Database Management System">RDBMS</abbr> with no dependencies and zero configurations; able to operate offline in-browser without a database engine.<br><mark>🚫 No server setup required to run this utility.</mark></small></p>
								<hr class='invisible-divider'>
								<span class='text-muted'>© Copyright <span id='copyrightYearDisplay'></span> by <a href='https://github.com/MessiDaGod/' target='_blank'>Joe Shakely</a> </span>
								<hr class='invisible-divider'>
								<div class="w-25 d-inline-block"><b>File Name:</b></div>
								<div id='fileNameDisplay' class="w-75 d-inline-block">---</div>
								<div class="w-25 d-inline-block"><b>File Size:</b></div>
								<div id='fileSizeDisplay' class="w-75 d-inline-block">---</div>
								<hr class='invisible-divider'>
								<div class="w-25 d-inline-block"><b>▦ Table(s):</b></div>
								<div id='noOfTablesDisplay' class="w-75 d-inline-block">---</div>
								<hr class='invisible-divider'>
							</td>
						</tr>
					</thead>
					<tbody id='dbTableDetails'></tbody>
				</table>
			</div>
		</div>
		<div class='col-sm-8 pl-0'>
			<div id='mainTabsWrapper' class='card rounded-0 border-right-0'>
				<ul id='mainTabs' class='nav nav-tabs' role='tablist'>
					<li class='nav-item'>
						<a class='nav-link rounded-0 active' id='browse-tab' href='#browse' data-bs-toggle='tab' data-height='true' aria-controls='browse' aria-selected='true' role='tab'><small>🔎 Browse Data</small></a>
					</li>
					<li class='nav-item'>
						<a class='nav-link rounded-0' id='editor-tab' href='#editor' data-bs-toggle='tab' data-height='true' aria-controls='editor' aria-selected='true' role='tab'><small>❮⁄❯ Query Editor</small></a>
					</li>
					<li class='nav-item'>
						<a class='nav-link rounded-0' id='logs-tab' href='#logs' data-bs-toggle='tab' data-height='true' aria-controls='logs' aria-selected='true' role='tab'><small>📝 Output Logs</small></a>
					</li>
				</ul>
				<div class='card-body tab-content'>
					<p id='errorDisplay' class='m-0 p-0 small text-danger'></p>
					<div id='browse' role='tabpanel' class='tab-pane fade active show' aria-labelledby='browse-tab'>
						<div class='btn-group btn-group-sm m-0'>
							<div class='btn-group btn-group-sm'>
								<button id='exportToggleBtn' type='button' class='btn btn-sm btn-light text-info border-info dropdown-toggle rounded-0' data-toggle='dropdown'><small>💾 Save…</small></button>
								<div class='dropdown-menu'>
									<button id='exportAsJSON' type='button' class='dropdown-item'><small>💽 Export datatable as JSON</small></button>
								</div>
							</div>
							<small id='tableDetails' class='ml-2'></small>
						</div>
						<hr class='invisible-divider'>
						<div id='tableRecords' class='table-responsive'></div>
						<hr class='invisible-divider'>
						<ul id='tablePagination' class='pagination pagination-sm rounded-0'></ul>
					</div>
					<div id='editor' role='tabpanel' class='tab-pane fade show' aria-labelledby='editor-tab'>
						<div class='btn-group btn-group-sm m-0'>
							<div class='btn-group btn-group-sm'>
								<button id='exportQueryToggleBtn' type='button' class='btn btn-sm btn-light text-info border-info dropdown-toggle rounded-0' data-toggle='dropdown'><small>💾 Save…</small></button>
								<div class='dropdown-menu'>
									<button id='exportQueryAsJSON' type='button' class='dropdown-item'><small>💽 Export resultset as JSON</small></button>
									<button id='exportEditorQuery' type='button' class='dropdown-item'><small>📄 Export SQL query to local file</small></button>
								</div>
							</div>
							<button id='runQueryBtn' type='button' class='btn btn-sm btn-light text-primary border-primary rounded-0 ml-2'><small>Run ⯈</small></button>
							<small id='tableQueryDetails' class='ml-2'></small>
						</div>
						<hr class='invisible-divider'>
						<p class='mb-0'><textarea id='lineCounter' wrap='off' readonly>1.</textarea><textarea id='codeEditor' wrap='off'></textarea></p>
						<div id='tableQueryRecords' class='table-responsive'></div>
						<hr class='invisible-divider'>
						<ul id='tableQueryPagination' class='pagination pagination-sm rounded-0'></ul>
					</div>
					<div id='logs' role='tabpanel' class='tab-pane fade show' aria-labelledby='logs-tab'>
						<hr class='invisible-divider'>
						<div id='logsRecords' class='table-responsive'></div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
}

@code {

  private bool isLoading = true;
  protected override async Task OnInitializedAsync() {
    await base.OnInitializedAsync();
  }

  protected override async Task OnAfterRenderAsync(bool firstRender)
  {
	await Task.Run(() => isLoading = false);
  }

}